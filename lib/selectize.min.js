/*! selectize.js - v0.6.2 | https://github.com/brianreavis/selectize.js | Apache License (v2) */
(function(g){"object"===typeof exports?g(require("jquery")):"function"===typeof define&&define.amd?define(["jquery"],g):g(jQuery)})(function(g){var x=function(a,b){if("string"!==typeof b||b.length){var c="string"===typeof b?RegExp(b,"i"):b,d=function(a){var b=0;if(3===a.nodeType){var k=a.data.search(c);if(0<=k&&0<a.data.length){var f=a.data.match(c),b=document.createElement("span");b.className="highlight";a=a.splitText(k);a.splitText(f[0].length);k=a.cloneNode(!0);b.appendChild(k);a.parentNode.replaceChild(b,
a);b=1}}else if(1===a.nodeType&&a.childNodes&&!/(script|style)/i.test(a.tagName))for(k=0;k<a.childNodes.length;++k)k+=d(a.childNodes[k]);return b};return a.each(function(){d(this)})}},r=function(){};r.prototype={on:function(a,b){this._events=this._events||{};this._events[a]=this._events[a]||[];this._events[a].push(b)},off:function(a,b){this._events=this._events||{};!1!==a in this._events&&this._events[a].splice(this._events[a].indexOf(b),1)},trigger:function(a){this._events=this._events||{};if(!1!==
a in this._events)for(var b=0;b<this._events[a].length;b++)this._events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}};r.mixin=function(a){for(var b=["on","off","trigger"],c=0;c<b.length;c++)a.prototype[b[c]]=r.prototype[b[c]]};var s=/Mac/.test(navigator.userAgent),y=s?91:17,z=s?18:17,t={a:"[a\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5]",c:"[c\u00c7\u00e7]",e:"[e\u00c8\u00c9\u00ca\u00cb\u00e8\u00e9\u00ea\u00eb]",i:"[i\u00cc\u00cd\u00ce\u00cf\u00ec\u00ed\u00ee\u00ef]",
n:"[n\u00d1\u00f1]",o:"[o\u00d2\u00d3\u00d4\u00d5\u00d5\u00d6\u00d8\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8]",s:"[s\u0160\u0161]",u:"[u\u00d9\u00da\u00db\u00dc\u00f9\u00fa\u00fb\u00fc]",y:"[y\u0178\u00ff\u00fd]",z:"[z\u017d\u017e]"},q=function(a){return"undefined"!==typeof a},l=function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},v={before:function(a,b,c){var d=a[b];a[b]=function(){c.apply(a,arguments);return d.apply(a,arguments)}},after:function(a,
b,c){var d=a[b];a[b]=function(){var b=d.apply(a,arguments);c.apply(a,arguments);return b}}},A=function(a){var b=!1;return function(){b||(b=!0,a.apply(this,arguments))}},B=function(a,b){var c;return function(){var d=this,e=arguments;window.clearTimeout(c);c=window.setTimeout(function(){a.apply(d,e)},b)}},w=function(a,b,c){var d;b=a.trigger;var e={};a.trigger=function(){e[arguments[0]]=arguments};c.apply(a,[]);a.trigger=b;for(d in e)e.hasOwnProperty(d)&&b.apply(a,e[d])},C=function(a,b,c,d){a.on(b,c,
function(b){for(var c=b.target;c&&c.parentNode!==a[0];)c=c.parentNode;b.currentTarget=c;return d.apply(this,[b])})},u=function(a){var b={};if("selectionStart"in a)b.start=a.selectionStart,b.length=a.selectionEnd-b.start;else if(document.selection){a.focus();var c=document.selection.createRange(),d=document.selection.createRange().text.length;c.moveStart("character",-a.value.length);b.start=c.text.length-d;b.length=d}return b},D=function(a){var b=function(b){var d,e,h;b=b||window.event||{};if(!b.metaKey&&
!b.altKey&&!1!==a.data("grow")){d=a.val();b.type&&"keydown"===b.type.toLowerCase()&&(e=b.keyCode,h=97<=e&&122>=e||65<=e&&90>=e||48<=e&&57>=e||32==e,46===e||8===e?(b=u(a[0]),b.length?d=d.substring(0,b.start)+d.substring(b.start+b.length):8===e&&b.start?d=d.substring(0,b.start-1)+d.substring(b.start+1):46===e&&"undefined"!==typeof b.start&&(d=d.substring(0,b.start)+d.substring(b.start+1))):h&&(e=b.shiftKey,b=String.fromCharCode(b.keyCode),b=e?b.toUpperCase():b.toLowerCase(),d+=b));b=a.attr("placeholder")||
"";!d.length&&b.length&&(d=b);d=g("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"nowrap"}).text(d).appendTo("body");b=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];e={};if(b)for(h=0;h<b.length;h++)e[b[h]]=a.css(b[h]);else e=a.css();d.css(e);b=d.width();d.remove();d=b+4;d!==a.width()&&(a.width(d),a.triggerHandler("resize"))}};a.on("keydown keyup update blur",b);b()},f=function(a,b){var c,d,e;a[0].selectize=this;this.$input=a;this.tagType=
"select"===a[0].tagName.toLowerCase()?1:2;this.settings=b;this.highlightedValue=null;this.hasOptions=this.ignoreHover=this.ignoreFocus=this.isCtrlDown=this.isCmdDown=this.isShiftDown=this.isSetup=this.isInputHidden=this.isInputFocused=this.isFocused=this.isLocked=this.isDisabled=this.isOpen=!1;this.currentResults=null;this.lastValue="";this.loading=this.caretPos=0;this.loadedSearches={};this.$activeOption=null;this.$activeItems=[];this.optgroups={};this.options={};this.userOptions={};this.items=[];
this.renderCache={};this.onSearchChange=B(this.onSearchChange,this.settings.loadThrottle);if(g.isArray(b.options))for(c=b.valueField,d=0,e=b.options.length;d<e;d++)b.options[d].hasOwnProperty(c)&&(this.options[b.options[d][c]]=b.options[d]);else"object"===typeof b.options&&(g.extend(this.options,b.options),delete this.settings.options);if(g.isArray(b.optgroups))for(c=b.optgroupValueField,d=0,e=b.optgroups.length;d<e;d++)b.optgroups[d].hasOwnProperty(c)&&(this.optgroups[b.optgroups[d][c]]=b.optgroups[d]);
else"object"===typeof b.optgroups&&(g.extend(this.optgroups,b.optgroups),delete this.settings.optgroups);this.settings.mode=this.settings.mode||(1===this.settings.maxItems?"single":"multi");"boolean"!==typeof this.settings.hideSelected&&(this.settings.hideSelected="multi"===this.settings.mode);this.loadPlugins(this.settings.plugins);this.setupCallbacks();this.setup()};r.mixin(f);(function(a,b){a.plugins={};a.prototype.loadPlugins=function(a){var b,e;this.plugins=[];this.pluginSettings={};if(g.isArray(a))for(b=
0,e=a.length;b<e;b++)this.loadPlugin(a[b]);else if(a)for(b in this.pluginSettings=g.extend({},a),a)a.hasOwnProperty(b)&&this.loadPlugin(b)};a.prototype.loadPlugin=function(c){var d,e,h;if(-1===this.plugins.indexOf(c)){if(!a.plugins.hasOwnProperty(c))throw Error(b+' unable to find "'+c+'" plugin');d=a.plugins[c];this.plugins.push(c);e=0;for(h=d.dependencies.length;e<h;e++)this.loadPlugin(d.dependencies[e]);d.fn.apply(this,[this.pluginSettings[c]||{}])}};a.registerPlugin=function(b){var d=arguments;
a.plugins[b]={name:b,fn:d[d.length-1],dependencies:3===d.length?d[1]:[]}}})(f,"Selectize");f.prototype.setup=function(){var a=this,b,c,d,e,h,k;d=this.$input.attr("tabindex")||"";b=this.$input.attr("class")||"";b=g("<div>").addClass(this.settings.theme).addClass(this.settings.wrapperClass).addClass(b);c=g("<div>").addClass(this.settings.inputClass).addClass("items").toggleClass("has-options",!g.isEmptyObject(this.options)).appendTo(b);d=g('<input type="text">').appendTo(c).attr("tabindex",d);e=g("<div>").addClass(this.settings.dropdownClass).hide().appendTo(b);
h=g("<div>").addClass(this.settings.dropdownContentClass).appendTo(e);b.css({width:this.$input[0].style.width,display:this.$input.css("display")});this.plugins.length&&b.addClass("plugin-"+this.plugins.join(" plugin-"));k=this.settings.mode;b.toggleClass("single","single"===k);b.toggleClass("multi","multi"===k);(null===this.settings.maxItems||1<this.settings.maxItems)&&1===this.tagType&&this.$input.attr("multiple","multiple");this.settings.placeholder&&d.attr("placeholder",this.settings.placeholder);
this.$wrapper=b;this.$control=c;this.$control_input=d;this.$dropdown=e;this.$dropdown_content=h;c.on("mousedown",function(b){b.isDefaultPrevented()||window.setTimeout(function(){a.focus(!0)},0)});e.on("mouseenter","[data-selectable]",function(){return a.onOptionHover.apply(a,arguments)});e.on("mousedown","[data-selectable]",function(){return a.onOptionSelect.apply(a,arguments)});C(c,"mousedown","*:not(input)",function(){return a.onItemSelect.apply(a,arguments)});D(d);d.on({mousedown:function(a){a.stopPropagation()},
keydown:function(){return a.onKeyDown.apply(a,arguments)},keyup:function(){return a.onKeyUp.apply(a,arguments)},keypress:function(){return a.onKeyPress.apply(a,arguments)},resize:function(){a.positionDropdown.apply(a,[])},blur:function(){return a.onBlur.apply(a,arguments)},focus:function(){return a.onFocus.apply(a,arguments)}});g(document).on({keydown:function(b){a.isCmdDown=b[s?"metaKey":"ctrlKey"];a.isCtrlDown=b[s?"altKey":"ctrlKey"];a.isShiftDown=b.shiftKey},keyup:function(b){b.keyCode===z&&(a.isCtrlDown=
!1);16===b.keyCode&&(a.isShiftDown=!1);b.keyCode===y&&(a.isCmdDown=!1)},mousedown:function(b){if(a.isFocused)if(b.target===a.$dropdown[0]){var d=a.ignoreFocus;a.ignoreFocus=!0;window.setTimeout(function(){a.ignoreFocus=d;a.focus(!1)},0)}else a.$control.has(b.target).length||b.target===a.$control[0]||a.blur()}});g(window).on({resize:function(){a.isOpen&&a.positionDropdown.apply(a,arguments)},mousemove:function(){a.ignoreHover=!1}});this.$input.attr("tabindex",-1).hide().after(this.$wrapper);g.isArray(this.settings.items)&&
(this.setValue(this.settings.items),delete this.settings.items);this.updateOriginalInput();this.refreshItems();this.updatePlaceholder();this.isSetup=!0;this.$input.is(":disabled")&&this.disable();if(this.settings.preload)this.onSearchChange("")};f.prototype.setupCallbacks=function(){var a,b,c={change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",
type:"onType"};for(a in c)if(c.hasOwnProperty(a)&&(b=this.settings[c[a]]))this.on(a,b)};f.prototype.triggerCallback=function(a){var b;"function"===typeof this.settings[a]&&(b=Array.prototype.slice.apply(arguments,[1]),this.settings[a].apply(this,b))};f.prototype.onKeyPress=function(a){if(this.isLocked)return a&&a.preventDefault();var b=String.fromCharCode(a.keyCode||a.which);if(this.settings.create&&b===this.settings.delimiter)return this.createItem(),a.preventDefault(),!1};f.prototype.onKeyDown=
function(a){if(this.isLocked)9!==a.keyCode&&a.preventDefault();else{switch(a.keyCode){case 65:if(this.isCmdDown){this.selectAll();a.preventDefault();return}break;case 27:this.blur();return;case 40:if(!this.isOpen&&this.hasOptions)this.open();else if(this.$activeOption){this.ignoreHover=!0;var b=this.getAdjacentOption(this.$activeOption,1);b.length&&this.setActiveOption(b,!0,!0)}a.preventDefault();return;case 38:this.$activeOption&&(this.ignoreHover=!0,b=this.getAdjacentOption(this.$activeOption,-1),
b.length&&this.setActiveOption(b,!0,!0));a.preventDefault();return;case 13:if(this.$activeOption)this.onOptionSelect({currentTarget:this.$activeOption});a.preventDefault();return;case 37:this.advanceSelection(-1,a);return;case 39:this.advanceSelection(1,a);return;case 9:this.settings.create&&g.trim(this.$control_input.val()).length&&(this.createItem(),a.preventDefault());return;case 8:case 46:this.deleteSelection(a);return}(this.isFull()||this.isInputHidden)&&a.preventDefault()}};f.prototype.onKeyUp=
function(a){if(this.isLocked)return a&&a.preventDefault();a=this.$control_input.val()||"";this.lastValue!==a&&(this.lastValue=a,this.onSearchChange(a),this.refreshOptions(),this.trigger("type",a))};f.prototype.onSearchChange=function(a){var b=this,c=b.settings.load;c&&!b.loadedSearches.hasOwnProperty(a)&&(b.loadedSearches[a]=!0,b.load(function(d){c.apply(b,[a,d])}))};f.prototype.onFocus=function(a){this.isFocused=this.isInputFocused=!0;if(this.isDisabled)return this.blur(),a.preventDefault(),!1;if(!this.ignoreFocus){if("focus"===
this.settings.preload)this.onSearchChange("");this.showInput();this.setActiveItem(null);this.refreshOptions(!!this.settings.openOnFocus);this.refreshClasses()}};f.prototype.onBlur=function(a){this.isInputFocused=!1;this.ignoreFocus||(this.close(),this.setTextboxValue(""),this.setActiveItem(null),this.setActiveOption(null),this.setCaret(this.items.length),this.isFocused=!1,this.refreshClasses())};f.prototype.onOptionHover=function(a){this.ignoreHover||this.setActiveOption(a.currentTarget,!1)};f.prototype.onOptionSelect=
function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();this.focus(!1);a=g(a.currentTarget);if(a.hasClass("create"))this.createItem();else if(a=a.attr("data-value"))this.setTextboxValue(""),this.addItem(a)};f.prototype.onItemSelect=function(a){"multi"===this.settings.mode&&(a.preventDefault(),this.setActiveItem(a.currentTarget,a),this.focus(!1),this.hideInput())};f.prototype.load=function(a){var b=this,c=b.$wrapper.addClass("loading");b.loading++;a.apply(b,[function(a){b.loading=
Math.max(b.loading-1,0);a&&a.length&&(b.addOption(a),b.refreshOptions(!1),b.isInputFocused&&b.open());b.loading||c.removeClass("loading");b.trigger("load",a)}])};f.prototype.setTextboxValue=function(a){this.$control_input.val(a).triggerHandler("update");this.lastValue=a};f.prototype.getValue=function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)};f.prototype.setValue=function(a){w(this,["change"],function(){this.clear();for(var b=g.isArray(a)?
a:[a],c=0,d=b.length;c<d;c++)this.addItem(b[c])})};f.prototype.setActiveItem=function(a,b){var c,d,e;a=g(a);if(a.length){c=b&&b.type.toLowerCase();if("mousedown"===c&&this.isShiftDown&&this.$activeItems.length){c=this.$control.children(".active:last");d=Array.prototype.indexOf.apply(this.$control[0].childNodes,[c[0]]);c=Array.prototype.indexOf.apply(this.$control[0].childNodes,[a[0]]);d>c&&(e=d,d=c,c=e);for(;d<=c;d++)e=this.$control[0].childNodes[d],-1===this.$activeItems.indexOf(e)&&(g(e).addClass("active"),
this.$activeItems.push(e));b.preventDefault()}else"mousedown"===c&&this.isCtrlDown||"keydown"===c&&this.isShiftDown?a.hasClass("active")?(c=this.$activeItems.indexOf(a[0]),this.$activeItems.splice(c,1),a.removeClass("active")):this.$activeItems.push(a.addClass("active")[0]):(g(this.$activeItems).removeClass("active"),this.$activeItems=[a.addClass("active")[0]]);this.isFocused=!!this.$activeItems.length||this.isInputFocused}else g(this.$activeItems).removeClass("active"),this.$activeItems=[],this.isFocused=
this.isInputFocused};f.prototype.setActiveOption=function(a,b,c){var d,e,h;this.$activeOption&&this.$activeOption.removeClass("active");this.$activeOption=null;a=g(a);a.length&&(this.$activeOption=a.addClass("active"),b||!q(b))&&(a=this.$dropdown.height(),d=this.$activeOption.outerHeight(!0),b=this.$dropdown.scrollTop()||0,e=this.$activeOption.offset().top-this.$dropdown.offset().top+b,h=e-a+d,e+d>a-b?this.$dropdown.stop().animate({scrollTop:h},c?this.settings.scrollDuration:0):e<b&&this.$dropdown.stop().animate({scrollTop:e},
c?this.settings.scrollDuration:0))};f.prototype.selectAll=function(){this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active"));this.isFocused=!0;this.$activeItems.length&&this.hideInput()};f.prototype.hideInput=function(){this.close();this.setTextboxValue("");this.$control_input.css({opacity:0,position:"relative",left:-1E4});this.isInputHidden=!0};f.prototype.showInput=function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=
!1};f.prototype.focus=function(a){if(!this.isDisabled){var b=this;b.ignoreFocus=!0;b.$control_input[0].focus();b.isInputFocused=!0;window.setTimeout(function(){b.ignoreFocus=!1;if(a)b.onFocus()},0)}};f.prototype.blur=function(){this.$control_input.trigger("blur")};f.prototype.parseSearchTokens=function(a){a=g.trim(String(a||"").toLowerCase());if(!a||!a.length)return[];var b,c,d,e=[],h=a.split(/ +/);a=0;for(b=h.length;a<b;a++){c=(h[a]+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");if(this.settings.diacritics)for(d in t)t.hasOwnProperty(d)&&
(c=c.replace(RegExp(d,"g"),t[d]));e.push({string:h[a],regex:RegExp(c,"i")})}return e};f.prototype.getScoreFunction=function(a){var b=this,c=a.tokens,d=function(){return c.length?1===c.length?function(a){var b;a=String(a||"").toLowerCase();b=a.search(c[0].regex);if(-1===b)return 0;a=c[0].string.length/a.length;0===b&&(a+=0.5);return a}:function(a){var b,d,f,g;a=String(a||"").toLowerCase();f=b=0;for(g=c.length;f<g;f++){d=a.search(c[f].regex);if(-1===d)return 0;0===d&&(b+=0.5);b+=c[f].string.length/
a.length}return b/c.length}:function(){return 0}}();return function(){var a=b.settings.searchField;"string"===typeof a&&(a=[a]);if(a&&a.length){if(1===a.length){var c=a[0];return function(a){return a.hasOwnProperty(c)?d(a[c]):0}}return function(b){for(var c=0,h=0,f=0,g=a.length;f<g;f++)b.hasOwnProperty(a[f])&&(h+=d(b[a[f]]),c++);return h/c}}return function(){return 0}}()};f.prototype.search=function(a,b){var c=this,d,e,h,k;b=b||{};a=g.trim(String(a||"").toLowerCase());if(a!==this.lastQuery){this.lastQuery=
a;h={query:a,tokens:this.parseSearchTokens(a),total:0,items:[]};if(this.settings.score){if(k=this.settings.score.apply(this,[h]),"function"!==typeof k)throw Error('Selectize "score" setting must be a function that returns a function');}else k=this.getScoreFunction(h);if(a.length){for(d in this.options)this.options.hasOwnProperty(d)&&(e=k(this.options[d]),0<e&&h.items.push({score:e,value:d}));h.items.sort(function(a,b){return b.score-a.score})}else{for(d in this.options)this.options.hasOwnProperty(d)&&
h.items.push({score:1,value:d});this.settings.sortField&&h.items.sort(function(){var a=c.settings.sortField,b="desc"===c.settings.sortDirection?-1:1;return function(d,e){d=d&&String(c.options[d.value][a]||"").toLowerCase();e=e&&String(c.options[e.value][a]||"").toLowerCase();return d>e?1*b:e>d?-1*b:0}}())}this.currentResults=h}else h=g.extend(!0,{},this.currentResults);return this.prepareResults(h,b)};f.prototype.prepareResults=function(a,b){if(this.settings.hideSelected)for(var c=a.items.length-
1;0<=c;c--)-1!==this.items.indexOf(String(a.items[c].value))&&a.items.splice(c,1);a.total=a.items.length;"number"===typeof b.limit&&(a.items=a.items.slice(0,b.limit));return a};f.prototype.refreshOptions=function(a){"undefined"===typeof a&&(a=!0);var b,c,d,e,h,k,f,m=this.$control_input.val(),n=this.search(m,{}),l,p=this.$dropdown_content;c=n.items.length;"number"===typeof this.settings.maxOptions&&(c=Math.min(c,this.settings.maxOptions));d={};if(this.settings.optgroupOrder)for(e=this.settings.optgroupOrder,
b=0;b<e.length;b++)d[e[b]]=[];else e=[];for(b=0;b<c;b++)h=this.options[n.items[b].value],k=h[this.settings.optgroupField]||"",this.optgroups.hasOwnProperty(k)||(k=""),d.hasOwnProperty(k)||(d[k]=[],e.push(k)),d[k].push(this.render("option",h));h=[];b=0;for(c=e.length;b<c;b++)k=e[b],this.optgroups.hasOwnProperty(k)&&d[k].length?(f=this.render("optgroup_header",this.optgroups[k])||"",f+=d[k].join(""),h.push(this.render("optgroup",g.extend({},this.optgroups[k],{html:f})))):h.push(d[k].join(""));p.html(h.join(""));
if(this.settings.highlight&&n.query.length&&n.tokens.length)for(b=0,c=n.tokens.length;b<c;b++)x(p,n.tokens[b].regex);if(!this.settings.hideSelected)for(b=0,c=this.items.length;b<c;b++)this.getOption(this.items[b]).addClass("selected");if(b=this.settings.create&&n.query.length)p.prepend(this.render("option_create",{input:m})),l=g(p[0].childNodes[0]);(this.hasOptions=0<n.items.length||b)?(m=0<n.items.length?l?this.getAdjacentOption(l,1):p.find("[data-selectable]").first():l,this.setActiveOption(m),
a&&!this.isOpen&&this.open()):(this.setActiveOption(null),a&&this.isOpen&&this.close())};f.prototype.addOption=function(a,b){var c,d;if(g.isArray(a))for(c=0,d=a.length;c<d;c++)this.addOption(a[c][this.settings.valueField],a[c]);else a=a||"",this.options.hasOwnProperty(a)||(this.userOptions[a]=!0,this.options[a]=b,this.lastQuery=null,this.trigger("option_add",a,b))};f.prototype.addOptionGroup=function(a,b){this.optgroups[a]=b;this.trigger("optgroup_add",value,b)};f.prototype.updateOption=function(a,
b){a=String(a);this.options[a]=b;q(this.renderCache.item)&&delete this.renderCache.item[a];q(this.renderCache.option)&&delete this.renderCache.option[a];if(-1!==this.items.indexOf(a)){var c=this.getItem(a),d=g(this.render("item",b));c.hasClass("active")&&d.addClass("active");c.replaceWith(d)}this.isOpen&&this.refreshOptions(!1)};f.prototype.removeOption=function(a){a=String(a);delete this.userOptions[a];delete this.options[a];this.lastQuery=null;this.trigger("option_remove",a);this.removeItem(a)};
f.prototype.clearOptions=function(){this.loadedSearches={};this.userOptions={};this.options={};this.lastQuery=null;this.trigger("option_clear");this.clear()};f.prototype.getOption=function(a){return a?this.$dropdown_content.find("[data-selectable]").filter('[data-value="'+a.replace(/(['"])/g,"\\$1")+'"]:first'):g()};f.prototype.getAdjacentOption=function(a,b){var c=this.$dropdown.find("[data-selectable]"),d=c.index(a)+b;return 0<=d&&d<c.length?c.eq(d):g()};f.prototype.getItem=function(a){var b=this.items.indexOf(a);
return-1!==b&&(b>=this.caretPos&&b++,b=g(this.$control[0].childNodes[b]),b.attr("data-value")===a)?b:g()};f.prototype.addItem=function(a){w(this,["change"],function(){var b,c,d=this,e=this.settings.mode,h;a=String(a);"single"===e&&this.clear();"multi"===e&&this.isFull()||(-1!==this.items.indexOf(a)||!this.options.hasOwnProperty(a))||(b=g(this.render("item",this.options[a])),this.items.splice(this.caretPos,0,a),this.insertAtCaret(b),this.refreshClasses(),this.isSetup&&(h=this.$dropdown_content.find("[data-selectable]"),
c=this.getOption(a),c=this.getAdjacentOption(c,1).attr("data-value"),this.refreshOptions(!0),c&&this.setActiveOption(this.getOption(c)),!h.length||null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems?this.close():this.positionDropdown(),this.isFocused&&window.setTimeout(function(){"single"===e?(d.blur(),d.focus(!1),d.hideInput()):d.focus(!1)},0),this.updatePlaceholder(),this.trigger("item_add",a,b),this.updateOriginalInput()))})};f.prototype.removeItem=function(a){var b,c;b="object"===
typeof a?a:this.getItem(a);a=String(b.attr("data-value"));c=this.items.indexOf(a);-1!==c&&(b.remove(),b.hasClass("active")&&(b=this.$activeItems.indexOf(b[0]),this.$activeItems.splice(b,1)),this.items.splice(c,1),this.lastQuery=null,!this.settings.persist&&this.userOptions.hasOwnProperty(a)&&this.removeOption(a),c<this.caretPos&&this.setCaret(this.caretPos-1),this.refreshClasses(),this.updatePlaceholder(),this.updateOriginalInput(),this.positionDropdown(),this.trigger("item_remove",a))};f.prototype.createItem=
function(){var a=this,b=g.trim(this.$control_input.val()||""),c=this.caretPos;if(b.length){this.lock();var d="function"===typeof this.settings.create?this.settings.create:function(b){var d={};d[a.settings.labelField]=b;d[a.settings.valueField]=b;return d},e=A(function(b){a.unlock();a.focus(!1);var d=b&&b[a.settings.valueField];d&&(a.setTextboxValue(""),a.addOption(d,b),a.setCaret(c),a.addItem(d),a.refreshOptions(!0),a.focus(!1))}),b=d.apply(this,[b,e]);"undefined"!==typeof b&&e(b)}};f.prototype.refreshItems=
function(){this.lastQuery=null;if(this.isSetup)for(var a=0;a<this.items.length;a++)this.addItem(this.items);this.refreshClasses();this.updateOriginalInput()};f.prototype.refreshClasses=function(){var a=this.isFull(),b=this.isLocked;this.$control.toggleClass("focus",this.isFocused).toggleClass("disabled",this.isDisabled).toggleClass("locked",b).toggleClass("full",a).toggleClass("not-full",!a).toggleClass("has-items",0<this.items.length);this.$control_input.data("grow",!a&&!b)};f.prototype.isFull=function(){return null!==
this.settings.maxItems&&this.items.length>=this.settings.maxItems};f.prototype.updateOriginalInput=function(){var a,b,c;if("select"===this.$input[0].tagName.toLowerCase()){c=[];a=0;for(b=this.items.length;a<b;a++)c.push('<option value="'+l(this.items[a])+'" selected="selected"></option>');c.length||this.$input.attr("multiple")||c.push('<option value="" selected="selected"></option>');this.$input.html(c.join(""))}else this.$input.val(this.getValue());this.$input.trigger("change");this.isSetup&&this.trigger("change",
this.$input.val())};f.prototype.updatePlaceholder=function(){if(this.settings.placeholder){var a=this.$control_input;this.items.length?a.removeAttr("placeholder"):a.attr("placeholder",this.settings.placeholder);a.triggerHandler("update")}};f.prototype.open=function(){this.isLocked||(this.isOpen||"multi"===this.settings.mode&&this.isFull())||(this.focus(),this.isOpen=!0,this.$dropdown.css({visibility:"hidden",display:"block"}),this.$control.addClass("dropdown-active"),this.positionDropdown(),this.$dropdown.css({visibility:"visible"}),
this.trigger("dropdown_open",this.$dropdown))};f.prototype.close=function(){this.isOpen&&(this.$dropdown.hide(),this.$control.removeClass("dropdown-active"),this.setActiveOption(null),this.isOpen=!1,this.trigger("dropdown_close",this.$dropdown))};f.prototype.positionDropdown=function(){var a=this.$control,b=a.position();b.top+=a.outerHeight(!0);this.$dropdown.css({width:a.outerWidth(),top:b.top,left:b.left})};f.prototype.clear=function(){this.items.length&&(this.$control.children(":not(input)").remove(),
this.items=[],this.setCaret(0),this.updatePlaceholder(),this.updateOriginalInput(),this.refreshClasses(),this.showInput(),this.trigger("clear"))};f.prototype.insertAtCaret=function(a){var b=Math.min(this.caretPos,this.items.length);0===b?this.$control.prepend(a):g(this.$control[0].childNodes[b]).before(a);this.setCaret(b+1)};f.prototype.deleteSelection=function(a){var b,c,d,e;b=a&&8===a.keyCode?-1:1;c=u(this.$control_input[0]);d=[];if(this.$activeItems.length){e=this.$control.children(".active:"+
(0<b?"last":"first"));e=this.$control.children(":not(input)").index(e);0<b&&e++;b=0;for(c=this.$activeItems.length;b<c;b++)d.push(g(this.$activeItems[b]).attr("data-value"));a&&(a.preventDefault(),a.stopPropagation())}else(this.isFocused||"single"===this.settings.mode)&&this.items.length&&(0>b&&0===c.start&&0===c.length?d.push(this.items[this.caretPos-1]):0<b&&c.start===this.$control_input.val().length&&d.push(this.items[this.caretPos]));if(!d.length||"function"===typeof this.settings.onDelete&&!1===
this.settings.onDelete(d))return!1;for("undefined"!==typeof e&&this.setCaret(e);d.length;)this.removeItem(d.pop());this.showInput();this.refreshOptions(!0);return!0};f.prototype.advanceSelection=function(a,b){var c,d;0!==a&&(c=0<a?"last":"first",d=u(this.$control_input[0]),this.isInputFocused&&!this.isInputHidden?(c=this.$control_input.val().length,(d=0>a?0===d.start&&0===d.length:d.start===c)&&!c&&this.advanceCaret(a,b)):(d=this.$control.children(".active:"+c),d.length&&(d=this.$control.children(":not(input)").index(d),
this.setActiveItem(null),this.setCaret(0<a?d+1:d),this.showInput())))};f.prototype.advanceCaret=function(a,b){if(0!==a){var c=0<a?"next":"prev";this.isShiftDown?(c=this.$control_input[c](),c.length&&(this.hideInput(),this.setActiveItem(c),b&&b.preventDefault())):this.setCaret(this.caretPos+a)}};f.prototype.setCaret=function(a){a="single"===this.settings.mode?this.items.length:Math.max(0,Math.min(this.items.length,a));var b,c,d,e;d=this.$control.children(":not(input)");b=0;for(c=d.length;b<c;b++)e=
g(d[b]).detach(),b<a?this.$control_input.before(e):this.$control.append(e);this.caretPos=a};f.prototype.lock=function(){this.close();this.isLocked=!0;this.refreshClasses()};f.prototype.unlock=function(){this.isLocked=!1;this.refreshClasses()};f.prototype.disable=function(){this.isDisabled=!0;this.lock()};f.prototype.enable=function(){this.isDisabled=!1;this.unlock()};f.prototype.render=function(a,b){var c,d,e="",h=!1,f=/^[\\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if("option"===a||"item"===
a)c=b[this.settings.valueField],h=q(c);if(h&&(q(this.renderCache[a])||(this.renderCache[a]={}),this.renderCache[a].hasOwnProperty(c)))return this.renderCache[a][c];if(this.settings.render&&"function"===typeof this.settings.render[a])e=this.settings.render[a].apply(this,[b,l]);else switch(d=b[this.settings.labelField],a){case "optgroup":e='<div class="optgroup">'+b.html+"</div>";break;case "optgroup_header":d=b[this.settings.optgroupLabelField];e='<div class="optgroup-header">'+l(d)+"</div>";break;
case "option":e='<div class="option">'+l(d)+"</div>";break;case "item":e='<div class="item">'+l(d)+"</div>";break;case "option_create":e='<div class="create">Create <strong>'+l(b.input)+"</strong>&hellip;</div>"}if("option"===a||"option_create"===a)e=e.replace(f,"<$1 data-selectable");"optgroup"===a&&(d=b[this.settings.optgroupValueField]||"",e=e.replace(f,'<$1 data-group="'+l(d)+'"'));if("option"===a||"item"===a)e=e.replace(f,'<$1 data-value="'+l(c||"")+'"');h&&(this.renderCache[a][c]=e);return e};
f.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,highlight:!0,openOnFocus:!0,maxOptions:1E3,maxItems:null,hideSelected:null,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",sortField:null,sortDirection:"asc",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,searchField:["text"],mode:null,theme:"default",wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",
dropdownContentClass:"selectize-dropdown-content",load:null,score:null,onChange:null,onItemAdd:null,onItemRemove:null,onClear:null,onOptionAdd:null,onOptionRemove:null,onOptionClear:null,onDropdownOpen:null,onDropdownClose:null,onType:null,onDelete:null,render:{item:null,optgroup:null,optgroup_header:null,option:null,option_create:null}};g.fn.selectize=function(a){a=a||{};var b=g.fn.selectize.defaults,c=a.dataAttr||b.dataAttr,d=function(a,b){var d,f,m,n;b.maxItems=a.attr("multiple")?null:1;var l=
function(a){a=c&&a.attr(c);return"string"===typeof a&&a.length?JSON.parse(a):null},p=function(a,d){a=g(a);var c=a.attr("value")||"";c.length&&(b.options[c]=l(a)||{text:a.html(),value:c,optgroup:d},a.is(":selected")&&b.items.push(c))},q=function(a){var d,c=g("option",a);a=g(a);var e=a.attr("label");e&&e.length&&(b.optgroups[e]=l(a)||{label:e});a=0;for(d=c.length;a<d;a++)p(c[a],e)};n=a.children();d=0;for(f=n.length;d<f;d++)m=n[d].tagName.toLowerCase(),"optgroup"===m?q(n[d]):"option"===m&&p(n[d])};return this.each(function(){var c,
h=g(this),k=h[0].tagName.toLowerCase();c={placeholder:h.attr("placeholder"),options:{},optgroups:{},items:[]};if("select"===k)d(h,c);else{var l,m,k=g.trim(h.val()||"");if(k.length){m=k.split(a.delimiter||b.delimiter);k=0;for(l=m.length;k<l;k++)c.options[m[k]]={text:m[k],value:m[k]};c.items=m}}c=new f(h,g.extend(!0,{},b,c,a));h.data("selectize",c);h.addClass("selectized")})};g.fn.selectize.defaults=f.defaults;f.registerPlugin("drag_drop",function(a){if(!g.fn.sortable)throw Error('The "drag_drop" Selectize plugin requires jQuery UI "sortable".');
if("multi"===this.settings.mode){var b=this;this.setup=function(){var a=b.setup;return function(){a.apply(this,arguments);var d=this.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,start:function(a,b){b.placeholder.css("width",b.helper.css("width"));d.css({overflow:"visible"})},stop:function(){d.css({overflow:"hidden"});var a=this.$activeItems?this.$activeItems.slice():null,c=[];d.children("[data-value]").each(function(){c.push(g(this).attr("data-value"))});b.setValue(c);b.setActiveItem(a)}})}}()}});
f.registerPlugin("optgroup_columns",function(a){var b=this;a=g.extend({equalizeWidth:!0,equalizeHeight:!0},a);this.getAdjacentOption=function(a,b){var c=a.closest("[data-group]").find("[data-selectable]"),f=c.index(a)+b;return 0<=f&&f<c.length?c.eq(f):g()};this.onKeyDown=function(){var a=b.onKeyDown;return function(c){var f,g;if(!this.isOpen||37!==c.keyCode&&39!==c.keyCode)return a.apply(this,arguments);b.ignoreHover=!0;g=this.$activeOption.closest("[data-group]");f=g.find("[data-selectable]").index(this.$activeOption);
g=37===c.keyCode?g.prev("[data-group]"):g.next("[data-group]");g=g.find("[data-selectable]");f=g.eq(Math.min(g.length-1,f));f.length&&this.setActiveOption(f)}}();var c=function(){var c,e,f,k;k=g("[data-group]",b.$dropdown_content);if((e=k.length)&&b.$dropdown_content.width()){if(a.equalizeHeight){for(c=f=0;c<e;c++)f=Math.max(f,k.eq(c).height());k.css({height:f})}a.equalizeWidth&&(f=b.$dropdown_content.innerWidth(),c=Math.round(f/e),k.css({width:c}),1<e&&(c=f-c*(e-1),k.eq(e-1).css({width:c})))}};if(a.equalizeHeight||
a.equalizeWidth)v.after(this,"positionDropdown",c),v.after(this,"refreshOptions",c)});f.registerPlugin("remove_button",function(a){var b=this;this.settings.render.item=function(a){return'<div class="item">'+a[b.settings.labelField]+' <a href="javascript:void(0)" class="remove" tabindex="-1" title="Remove">&times;</a></div>'};this.setup=function(){var a=b.setup;return function(){a.apply(this,arguments);this.$control.on("click",".remove",function(a){a.preventDefault();a=g(a.target).parent();b.setActiveItem(a);
b.deleteSelection()&&b.setCaret(b.items.length)})}}()});f.registerPlugin("restore_on_backspace",function(a){var b=this;a.text=a.text||function(a){return a[this.settings.labelField]};this.onKeyDown=function(c){var d=b.onKeyDown;return function(b){var c;if(8===b.keyCode&&(""===this.$control_input.val()&&!this.$activeItems.length)&&(c=this.caretPos-1,0<=c&&c<this.items.length)){c=this.options[this.items[c]];this.deleteSelection(b)&&(this.setTextboxValue(a.text.apply(this,[c])),this.refreshOptions(!0));
b.preventDefault();return}return d.apply(this,arguments)}}()});return f});
